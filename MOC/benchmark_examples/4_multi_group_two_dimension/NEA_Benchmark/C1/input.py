# -*- coding: utf-8 -*-
"""
Created on Tue Mar 24 12:37:48 2020

@author: azmanrafee
"""
import numpy as np

UX=np.array([['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'X', 'U', 'U', 'X', 'U', 'U', 'X', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'X', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'X', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'X', 'U', 'U', 'X', 'U', 'U', 'X', 'U', 'U', 'X', 'U', 'U', 'X', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'X', 'U', 'U', 'X', 'U', 'U', 'C', 'U', 'U', 'X', 'U', 'U', 'X', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'X', 'U', 'U', 'X', 'U', 'U', 'X', 'U', 'U', 'X', 'U', 'U', 'X', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'X', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'X', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'X', 'U', 'U', 'X', 'U', 'U', 'X', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U']])

UA=np.array([['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'A', 'U', 'U', 'A', 'U', 'U', 'A', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'A', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'A', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'A', 'U', 'U', 'A', 'U', 'U', 'A', 'U', 'U', 'A', 'U', 'U', 'A', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'A', 'U', 'U', 'A', 'U', 'U', 'C', 'U', 'U', 'A', 'U', 'U', 'A', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'A', 'U', 'U', 'A', 'U', 'U', 'A', 'U', 'U', 'A', 'U', 'U', 'A', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'A', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'A', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'A', 'U', 'U', 'A', 'U', 'U', 'A', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U'],
             ['U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U', 'U']])

PX=np.array([['1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1'],
             ['1', '2', '2', '2', '2', '2', '2', '2', '2', '2', '2', '2', '2', '2', '2', '2', '1'],
             ['1', '2', '2', '2', '2', 'X', '2', '2', 'X', '2', '2', 'X', '2', '2', '2', '2', '1'],
             ['1', '2', '2', 'X', '2', '3', '3', '3', '3', '3', '3', '3', '2', 'X', '2', '2', '1'],
             ['1', '2', '2', '2', '3', '3', '3', '3', '3', '3', '3', '3', '3', '2', '2', '2', '1'],
             ['1', '2', 'X', '3', '3', 'X', '3', '3', 'X', '3', '3', 'X', '3', '3', 'X', '2', '1'],
             ['1', '2', '2', '3', '3', '3', '3', '3', '3', '3', '3', '3', '3', '3', '2', '2', '1'],
             ['1', '2', '2', '3', '3', '3', '3', '3', '3', '3', '3', '3', '3', '3', '2', '2', '1'],
             ['1', '2', 'X', '3', '3', 'X', '3', '3', 'C', '3', '3', 'X', '3', '3', 'X', '2', '1'],
             ['1', '2', '2', '3', '3', '3', '3', '3', '3', '3', '3', '3', '3', '3', '2', '2', '1'],
             ['1', '2', '2', '3', '3', '3', '3', '3', '3', '3', '3', '3', '3', '3', '2', '2', '1'],
             ['1', '2', 'X', '3', '3', 'X', '3', '3', 'X', '3', '3', 'X', '3', '3', 'X', '2', '1'],
             ['1', '2', '2', '2', '3', '3', '3', '3', '3', '3', '3', '3', '3', '2', '2', '2', '1'],
             ['1', '2', '2', 'X', '2', '3', '3', '3', '3', '3', '3', '3', '2', 'X', '2', '2', '1'],
             ['1', '2', '2', '2', '2', 'X', '2', '2', 'X', '2', '2', 'X', '2', '2', '2', '2', '1'],
             ['1', '2', '2', '2', '2', '2', '2', '2', '2', '2', '2', '2', '2', '2', '2', '2', '1'],
             ['1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1']])

R=np.array([['R']*17]*17)


X=21.42
Y=21.42
X0=1
XN=1
Y0=1
YN=1
groups=2
Nx=68
Ny=68
azim_div=32
d=0.1
cores=4



def geometry(x,y,UX=UX,UA=UA,PX=PX):
    import math
    v1=np.vstack((UX,UA))
    v2=np.vstack((UA,UX))
    gmu=np.hstack((v1,v2))
    gm=np.array([['']*68]*68)
    for i in range(34):
        for j in range(34):
            gm[2*i:2*i+2,2*j:2*j+2]=gmu[i,j]
    gm=gm[17:51,17:51]
    a=33-math.floor(y/0.63)
    b=math.floor(x/0.63)
    return np.array([gm[a,b]=='U',
                     gm[a,b]=='1',
                     gm[a,b]=='2',
                     gm[a,b]=='3',
                     gm[a,b]=='X',
                     gm[a,b]=='R',
                     gm[a,b]=='C',
                     gm[a,b]=='A',],dtype=int)


def sigma_trans(x,y):
    cs_sa=np.array([[0.010,0.015,0.015,0.015,0.001,0.001,0.001,0.040],
                    [0.100,0.200,0.250,0.300,0.020,0.040,0.020,0.800]])
    cs_sr=np.array([[0.020,0.015,0.015,0.015,0.025,0.050,0.025,0.010],
                    [0.000,0.000,0.000,0.000,0.000,0.000,0.000,0.000]])
    cs_ss=np.array([[0.540,0.520,0.520,0.520,0.560,0.560,0.560,0.480],
                    [1.000,0.900,0.830,0.760,1.200,2.300,1.200,0.050]])
    mu=np.array([[0.50]*8,[0.30]*8])
    
    return np.dot((cs_sa+cs_sr+(cs_ss*(1-mu))),geometry(x,y))

def sigma_scatter(x,y):
    cs_ss=np.array([[[0.540,0.520,0.520,0.520,0.560,0.560,0.560,0.480],[0.000,0.000,0.000,0.000,0.000,0.000,0.000,0.000]],
                    [[0.020,0.015,0.015,0.015,0.025,0.050,0.025,0.010],[1.000,0.900,0.830,0.760,1.200,2.300,1.200,0.050]]])
    mu=np.array([[[0.5]*8,[0.0]*8],
                 [[0.0]*8,[0.3]*8]])
    return np.dot((cs_ss*(1-mu)),geometry(x,y))

def sigma_fis(x,y):
    cs_ff=np.array([[0.0050,0.0075,0.0075,0.0075,0,0,1e-7,0],
                    [0.125 ,0.300 ,0.375 ,0.450 ,0,0,3e-6,0]])
    return np.dot(cs_ff,geometry(x,y))

def chi(x,y):
    
    return np.array([1,0])



